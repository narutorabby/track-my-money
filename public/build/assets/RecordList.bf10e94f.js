import{d as Y,o as R,c as M,a as m,_ as x,h as W,n as J,u as K,r as u,j as n,m as L,w as t,e,f as j,k as P,t as q,F as G,B as H,p as X,l as Z}from"./app.e02be635.js";import{h as $}from"./moment.9709ab41.js";import{C as ee}from"./Check.d985fa3f.js";import{P as te,E as oe}from"./Plus.aa9c0ee9.js";const le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},ae=m("path",{d:"M288 144a110.94 110.94 0 0 0-31.24 5a55.4 55.4 0 0 1 7.24 27a56 56 0 0 1-56 56a55.4 55.4 0 0 1-27-7.24A111.71 111.71 0 1 0 288 144zm284.52 97.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400c-98.65 0-189.09-55-237.93-144C98.91 167 189.34 112 288 112s189.09 55 237.93 144C477.1 345 386.66 400 288 400z",fill:"currentColor"},null,-1),ne=[ae],re=Y({name:"EyeRegular",render:function(a,r){return R(),M("svg",le,ne)}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 448 512"},ue=m("path",{d:"M268 416h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12zM432 80h-82.41l-34-56.7A48 48 0 0 0 274.41 0H173.59a48 48 0 0 0-41.16 23.3L98.41 80H16A16 16 0 0 0 0 96v16a16 16 0 0 0 16 16h16v336a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128h16a16 16 0 0 0 16-16V96a16 16 0 0 0-16-16zM171.84 50.91A6 6 0 0 1 177 48h94a6 6 0 0 1 5.15 2.91L293.61 80H154.39zM368 464H80V128h288zm-212-48h24a12 12 0 0 0 12-12V188a12 12 0 0 0-12-12h-24a12 12 0 0 0-12 12v216a12 12 0 0 0 12 12z",fill:"currentColor"},null,-1),de=[ue],ie=Y({name:"TrashAltRegular",render:function(a,r){return R(),M("svg",se,de)}}),ce={components:{Check:ee},props:{record:{type:Object,default:{id:0,title:"",amount:0,date:null,type:"",description:"",members:[]}},editFlag:{type:Boolean,default:!1},viewFlag:{type:Boolean,default:!1},groupId:{type:Number,default:null},members:{type:Array,default:[]}},setup(o,{emit:a}){W(),J();const r=K(),l=u(!1),z=u(null),f=u(o.record),E=u(o.viewFlag),c=u(o.editFlag),i=u(o.groupId),h=u(o.members),b=u([{label:"Income",value:"Income"},{label:"Expense",value:"Expense"}]),F=u([{label:"Contribution",value:"Contribution"},{label:"Bill",value:"Bill"}]),k=u({title:{required:!0,message:"Please enter title",trigger:["input","blur"]},amount:{required:!0,type:"number",message:"Please enter amount",validator(S,v){return v<=0?new Error("Please enter amount"):!0},trigger:["input","blur"]},date:{required:!0,message:"Please select date",trigger:["input","blur"]},type:{required:!0,message:"Please select type",trigger:["input","blur"]},description:{required:!1,validator(S,v){return v&&v.length>500?new Error("Description should be smaller than 500 characters"):!0},trigger:["input","blur"]}});return{formSubmitLoading:l,formRef:z,record:f,viewFlag:E,editFlag:c,groupId:i,members:h,personalRecordTypes:b,groupRecordTypes:F,rules:k,submitForm:S=>{S.preventDefault(),z.value.validate(v=>{if(v)r.error("Please enter proper information");else{l.value=!0;let y="",g={};c.value?(g={...f.value},y="/api/record/update/"+f.value.id):(g={...f.value},y="/api/record/create"),i.value&&(g.group_id=i.value),axios.post(y,g).then(d=>{d.data.response=="success"?(r.success(d.data.message),a("close",!0)):r.error(d.data.message),l.value=!1}).catch(d=>{console.log(d),l.value=!1,r.error(`Could not ${c.value?"edit":"create"} record!`)})}})},close:()=>{a("close",!1)}}}},pe=P("Cancel");function me(o,a,r,l,z,f){const E=n("n-input"),c=n("n-form-item"),i=n("n-gi"),h=n("n-grid"),b=n("n-input-number"),F=n("n-date-picker"),k=n("n-select"),_=n("n-button"),w=n("check"),S=n("n-icon"),v=n("n-space"),y=n("n-form"),g=n("n-card");return R(),L(g,{style:{width:"600px"},title:l.viewFlag?"View record":l.editFlag?"Edit record":"Create record",size:"huge",role:"dialog","aria-modal":"true"},{default:t(()=>[e(v,{vertical:""},{default:t(()=>[e(y,{ref:"formRef",model:l.record,rules:l.rules},{default:t(()=>[e(h,{cols:"1"},{default:t(()=>[e(i,null,{default:t(()=>[e(c,{label:"Title",path:"title"},{default:t(()=>[e(E,{value:l.record.title,"onUpdate:value":a[0]||(a[0]=d=>l.record.title=d),placeholder:"Input Title",maxlength:"60","show-count":"",readonly:l.viewFlag},null,8,["value","readonly"])]),_:1})]),_:1})]),_:1}),e(h,{cols:"3","x-gap":"12"},{default:t(()=>[e(i,null,{default:t(()=>[e(c,{label:"Amount",path:"amount"},{default:t(()=>[e(b,{value:l.record.amount,"onUpdate:value":a[1]||(a[1]=d=>l.record.amount=d),placeholder:"Input Amount",min:0,precision:2,readonly:l.viewFlag},null,8,["value","readonly"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(c,{label:"Date",path:"date"},{default:t(()=>[e(F,{"formatted-value":l.record.date,"onUpdate:formatted-value":a[2]||(a[2]=d=>l.record.date=d),placeholder:"Select a date",type:"date",disabled:l.viewFlag},null,8,["formatted-value","disabled"])]),_:1})]),_:1}),e(i,null,{default:t(()=>[e(c,{label:"Type",path:"type"},{default:t(()=>[e(k,{value:l.record.type,"onUpdate:value":a[3]||(a[3]=d=>l.record.type=d),placeholder:"Select record type",options:l.groupId?l.groupRecordTypes:l.personalRecordTypes,disabled:l.viewFlag},null,8,["value","options","disabled"])]),_:1})]),_:1})]),_:1}),l.groupId?(R(),L(h,{key:0,cols:"1"},{default:t(()=>[e(i,null,{default:t(()=>[e(c,{label:"Member(s)",path:"members"},{default:t(()=>[e(k,{value:l.record.members,"onUpdate:value":a[4]||(a[4]=d=>l.record.members=d),placeholder:"Select members(s)",options:l.members,"value-field":"id","label-field":"name",disabled:l.viewFlag||l.groupId&&!l.record.type,multiple:l.record.type=="Bill"},null,8,["value","options","disabled","multiple"])]),_:1})]),_:1})]),_:1})):j("",!0),e(h,{cols:"1"},{default:t(()=>[e(i,null,{default:t(()=>[e(c,{label:"Description",path:"description"},{default:t(()=>[e(E,{value:l.record.description,"onUpdate:value":a[5]||(a[5]=d=>l.record.description=d),placeholder:"Write a description...",type:"textarea",maxlength:"500","show-count":"",readonly:l.viewFlag},null,8,["value","readonly"])]),_:1})]),_:1})]),_:1}),e(v,{justify:"end"},{default:t(()=>[e(_,{onClick:l.close},{default:t(()=>[pe]),_:1},8,["onClick"]),l.viewFlag?j("",!0):(R(),L(_,{key:0,type:"primary",onClick:l.submitForm,loading:l.formSubmitLoading},{icon:t(()=>[e(S,null,{default:t(()=>[e(w)]),_:1})]),default:t(()=>[P(" "+q(l.editFlag?"Save":"Create"),1)]),_:1},8,["onClick","loading"]))]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["title"])}const ge=x(ce,[["render",me]]);const fe={components:{Plus:te,EyeRegular:re,EditRegular:oe,TrashAltRegular:ie,CreateEditRecord:ge},props:{isGroup:{type:Boolean,default:!1}},setup:o=>{const a=W(),r=J(),l=K(),z=u(o.isGroup),f=u(!0),E=u(!1),c=u(),i=u([]),h=u({id:0,title:"",amount:0,date:null,type:"",description:"",members:[]}),b=u(!1),F=u(!1),k=u(!1),_=u(1),w=u(10),S=u([{label:"Income",value:"Income"},{label:"Expense",value:"Expense"}]),v=u([{label:"Contribution",value:"Contribution"},{label:"Bill",value:"Bill"}]),y=u(null),g=u(null),d=u(null),B=()=>{f.value=!0,axios.get("/api/group/show/"+r.params.slug).then(p=>{p.data.response=="success"?(c.value=p.data.data,D()):l.error("Error fetching details. Please reload!"),f.value=!1})},T=()=>{f.value=!0;let p=z.value?"/api/record/group":"/api/record/personal";axios.get(p,{params:{group_id:z.value?c.value.id:null,type:y.value,date_from:g.value,date_to:d.value,page_size:w.value,page:_.value}}).then(U=>{U.data.response=="success"?(i.value=U.data.data,z.value&&i.value.data.forEach(C=>{let O=[];C.type=="Contribution"?O=C.shares[0].id:C.shares.forEach(Q=>{O.push(Q.id)}),C.members=O})):l.error("Error fetching list. Please reload!"),f.value=!1})},D=()=>{r.query.page!=null&&(_.value=parseInt(r.query.page)),r.query.page_size!=null&&(w.value=parseInt(r.query.page_size)),r.query.type!=null&&(y.value=r.query.type),r.query.date_from!=null&&(g.value=r.query.date_from),r.query.date_to!=null&&(d.value=r.query.date_to),T()},A=()=>{r.name=="GroupRecords"?B():D()};A();const s=()=>{f.value=!0;let p={};y.value&&(p.type=y.value),g.value&&(p.date_from=g.value),d.value&&(p.date_to=d.value),_.value=1,w.value=10,a.replace({name:"GroupRecords",query:{...p}}),T()},I=p=>{_.value=p,N()},V=p=>{w.value=p,N()},N=()=>{a.replace({name:"GroupRecords",query:Object.assign({},r.query,{page:_.value,page_size:w.value})}),T()};return{isGroup:z,pageLoading:f,formSubmitLoading:E,group:c,records:i,record:h,viewFlag:b,editFlag:F,showModalRef:k,currentPage:_,currentPageSize:w,personalRecordTypes:S,groupRecordTypes:v,recordType:y,dateFrom:g,dateTo:d,initAction:A,groupDetails:B,getRecords:T,getActiveFilters:D,getFilteredRecords:s,pageChanged:I,currentPageSizeChanged:V,getPaginatedRecords:N,openModal:()=>{k.value=!0},viewEditRecord:(p,U)=>{U=="edit"?F.value=!0:b.value=!0;let C=i.value.data[p];h.value={id:C.id,title:C.title,amount:C.amount,date:C.date,type:C.type,description:C.description,members:C.members},k.value=!0},closeModal:p=>{p&&A(),k.value=!1,b.value=!1,F.value=!1,h.value={id:0,title:"",amount:0,date:null,type:"",description:"",members:[]}},formatDate:p=>$(p).format("DD-MM-YYYY")}}},_e=o=>(X("data-v-71e19528"),o=o(),Z(),o),ve=P(" Create New "),ye=P("Submit"),he=_e(()=>m("thead",null,[m("tr",null,[m("th",null,"#"),m("th",null,"Date"),m("th",null,"Type"),m("th",null,"Amount"),m("th",null,"Title"),m("th")])],-1)),be={style:{"text-align":"end"}},we=P(" Edit "),Ce=P(" View "),Re=P(" Create New ");function ke(o,a,r,l,z,f){const E=n("plus"),c=n("n-icon"),i=n("n-button"),h=n("n-select"),b=n("n-gi"),F=n("n-date-picker"),k=n("n-grid"),_=n("n-card"),w=n("n-skeleton"),S=n("edit-regular"),v=n("eye-regular"),y=n("n-button-group"),g=n("n-table"),d=n("n-pagination"),B=n("n-space"),T=n("n-empty"),D=n("create-edit-record"),A=n("n-modal");return R(),L(_,{title:r.isGroup?"GROUP RECORDS":"PERSONAL RECORDS"},{"header-extra":t(()=>[e(i,{onClick:a[0]||(a[0]=s=>o.openModal())},{icon:t(()=>[e(c,null,{default:t(()=>[e(E)]),_:1})]),default:t(()=>[ve]),_:1})]),default:t(()=>[e(B,{class:"data-container",vertical:""},{default:t(()=>[e(_,{title:"List filters",hoverable:""},{default:t(()=>[e(k,{"x-gap":"24","y-gap":"12",cols:"1 m:4",responsive:"screen"},{default:t(()=>[e(b,null,{default:t(()=>[e(h,{placeholder:"Select record type",size:"large",value:o.recordType,"onUpdate:value":a[1]||(a[1]=s=>o.recordType=s),options:r.isGroup?o.groupRecordTypes:o.personalRecordTypes,clearable:""},null,8,["value","options"])]),_:1}),e(b,null,{default:t(()=>[e(F,{placeholder:"Select date from",size:"large","formatted-value":o.dateFrom,"onUpdate:formatted-value":a[2]||(a[2]=s=>o.dateFrom=s),"value-format":"dd-MM-yyyy",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),e(b,null,{default:t(()=>[e(F,{placeholder:"Select date to",size:"large","formatted-value":o.dateTo,"onUpdate:formatted-value":a[3]||(a[3]=s=>o.dateTo=s),"value-format":"dd-MM-yyyy",type:"date",clearable:""},null,8,["formatted-value"])]),_:1}),e(b,null,{default:t(()=>[e(i,{onClick:o.getFilteredRecords},{default:t(()=>[ye]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),o.pageLoading?(R(),M(G,{key:0},[e(w,{height:"50px"}),(R(),M(G,null,H(10,s=>e(w,{key:s,height:"50px"})),64))],64)):o.records&&o.records.total>0?(R(),M(G,{key:1},[e(g,{striped:""},{default:t(()=>[he,m("tbody",null,[(R(!0),M(G,null,H(o.records.data,(s,I)=>(R(),M("tr",{key:I},[m("td",null,q(I+1),1),m("td",null,q(o.formatDate(s.date)),1),m("td",null,q(s.type),1),m("td",null,q(s.amount.toLocaleString("en-BD")),1),m("td",null,q(s.title),1),m("td",be,[e(y,null,{default:t(()=>[e(i,{round:"",onClick:V=>o.viewEditRecord(I,"edit")},{icon:t(()=>[e(c,null,{default:t(()=>[e(S)]),_:1})]),default:t(()=>[we]),_:2},1032,["onClick"]),e(i,{round:"",onClick:V=>o.viewEditRecord(I,"view")},{icon:t(()=>[e(c,null,{default:t(()=>[e(v)]),_:1})]),default:t(()=>[Ce]),_:2},1032,["onClick"])]),_:2},1024)])]))),128))])]),_:1}),e(B,{justify:"end"},{default:t(()=>[e(d,{"item-count":o.records.total,page:o.currentPage,"onUpdate:page":a[4]||(a[4]=s=>o.currentPage=s),"page-size":o.currentPageSize,"onUpdate:page-size":a[5]||(a[5]=s=>o.currentPageSize=s),"page-sizes":[10,20,50,100],size:"large","show-size-picker":"","on-update:page":s=>{o.pageChanged(s)},"on-update:page-size":s=>{o.currentPageSizeChanged(s)}},null,8,["item-count","page","page-size","on-update:page","on-update:page-size"])]),_:1})],64)):(R(),L(T,{key:2,class:"empty",size:"huge",description:"No records found"},{extra:t(()=>[e(i,{onClick:a[6]||(a[6]=s=>o.openModal())},{icon:t(()=>[e(c,null,{default:t(()=>[e(E)]),_:1})]),default:t(()=>[Re]),_:1})]),_:1}))]),_:1}),e(A,{show:o.showModalRef,"onUpdate:show":a[7]||(a[7]=s=>o.showModalRef=s),"mask-closable":!1,"auto-focus":!1},{default:t(()=>[e(D,{record:o.record,editFlag:o.editFlag,viewFlag:o.viewFlag,groupId:r.isGroup?o.group.id:null,members:r.isGroup?o.group.members:[],onClose:o.closeModal},null,8,["record","editFlag","viewFlag","groupId","members","onClose"])]),_:1},8,["show"])]),_:1},8,["title"])}const qe=x(fe,[["render",ke],["__scopeId","data-v-71e19528"]]);export{qe as R};
